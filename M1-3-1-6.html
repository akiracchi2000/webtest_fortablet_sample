<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>第1節-6 2次関数のグラフのテスト (ランダム10題)</title>

    <!-- KaTeX（数式表示ライブラリ） -->
    <!-- KaTeX（数式表示ライブラリ） -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <!-- クイズデータ読み込み -->
    <script src="M1-3-1-6QD.js"></script>

    <style>
        /* 共通スタイル */
        :root {
            --bg-color: #f0f2f5;
            --text-color: #333;
            --panel-bg: #ffffff;
            --border-color: #ccc;
            --header-bg: #007bff;
            --header-text: #fff;
            --btn-bg: #fff;
            --btn-text: #333;
            --btn-hover: #dee2e6;
            --btn-active-bg: #007bff;
            --btn-active-text: #fff;
            --memo-bg: #ffffff;
            --overlay-bg: rgba(255, 255, 255, 0.9);
            --correct-color: #007bff;
            --incorrect-color: #dc3545;
            --correct-bg: #d4edda;
            --incorrect-bg: #f8d7da;
            --link-color: #007bff;
        }

        body.dark-mode {
            --bg-color: #121212;
            --text-color: #e0e0e0;
            --panel-bg: #1e1e1e;
            --border-color: #444;
            --header-bg: #1a1a1a;
            --header-text: #e0e0e0;
            --btn-bg: #2d2d2d;
            --btn-text: #e0e0e0;
            --btn-hover: #3d3d3d;
            --btn-active-bg: #bb86fc;
            --btn-active-text: #000;
            --memo-bg: #121212;
            --overlay-bg: rgba(30, 30, 30, 0.9);
            --correct-color: #66b0ff;
            --incorrect-color: #ff6b6b;
            --correct-bg: #1e4620;
            --incorrect-bg: #4c1d1d;
            --link-color: #8ab4f8;
        }

        body.dark-mode {
            --bg-color: #121212;
            --text-color: #e0e0e0;
            --panel-bg: #1e1e1e;
            --border-color: #333;
            --btn-text: #e0e0e0;
            --btn-hover: #3d3d3d;
            --btn-active-bg: #bb86fc;
            --btn-active-text: #000;
            --memo-bg: #121212;
            --overlay-bg: rgba(0, 0, 0, 0.9);
            --correct-color: #66b0ff;
            --incorrect-color: #ff6b6b;
            --correct-bg: #1e4620;
            --incorrect-bg: #4c1d1d;
            --link-color: #8ab4f8;
        }

        html,
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            display: flex;
            width: 100vw;
            height: 100vh;
            height: 100dvh;
            background-color: var(--bg-color);
            color: var(--text-color);
            overflow: hidden;
            overscroll-behavior: none;
            touch-action: none;
            transition: background-color 0.3s, color 0.3s;
        }

        /* --- 左パネル（クイズ） --- */
        #left-panel {
            flex: 0 0 50vw;
            width: 50vw;
            height: 100%;
            padding: 20px;
            box-sizing: border-box;
            overflow-y: auto;
            background-color: var(--panel-bg);
            transition: background-color 0.3s;
            overscroll-behavior: none;
            touch-action: pan-y;
            border-right: none;
        }

        /* --- リサイザー（境界線） --- */
        #resizer {
            width: 10px;
            background-color: var(--border-color);
            cursor: col-resize;
            z-index: 100;
            touch-action: none;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s;
        }

        #resizer:hover,
        #resizer.active {
            background-color: #007bff;
        }

        #resizer::after {
            content: "⋮";
            color: #666;
            font-size: 1.2em;
            font-weight: bold;
        }

        /* --- 右パネル（メモパッド） --- */
        #right-panel {
            flex: 0 0 50vw;
            width: 50vw;
            height: 100%;
            padding: 0;
            box-sizing: border-box;
            overflow: hidden;
            /* スクロールバーによる余白防止 */
            background-color: var(--panel-bg);
            transition: background-color 0.3s;
            position: relative;
            display: flex;
            flex-direction: column;
            touch-action: none;
            overscroll-behavior: none;
        }

        #memo-toolbar {
            height: 50px;
            background: var(--panel-bg);
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding: 0 15px;
            border-top: 1px solid var(--border-color);
            padding-bottom: env(safe-area-inset-bottom);
            height: auto;
            min-height: 50px;
            touch-action: manipulation;
            transition: background-color 0.3s, border-color 0.3s;
            position: relative;
            /* ページコントロール配置のため */
        }

        /* ページコントロール */
        #page-controls {
            position: static;
            transform: none;
            margin-right: auto;
            /* 左寄せ */
            display: flex;
            align-items: center;
            gap: 15px;
            color: var(--text-color);
            font-weight: bold;
            font-size: 1.1em;
            z-index: 5;
        }

        .page-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2em;
            color: var(--btn-text);
            padding: 5px 10px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .page-btn:hover:not(:disabled) {
            background: var(--btn-hover);
        }

        .page-btn:disabled {
            opacity: 0.3;
            cursor: default;
        }

        #memo-container {
            flex: 1;
            position: relative;
            cursor: crosshair;
            background: var(--memo-bg);
            /* 変数を使用 */
            margin: 0;
            border-radius: 0;
            box-shadow: none;
            overflow: hidden;
            touch-action: none;
            transition: background-color 0.3s;
            /* 背景画像の設定 */
            background-image: url('data:image/png;base64,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gAABAgQI5BcwIQECBAgQWE/AImY9J+8iQIAAAQIECOQUMBUBAgQIECDQlIBFTFPHZVgCBAgQIJBHwCQECBAgQIAAAQKbC1jEbG7mCgIECBCYVsDdCRAgQIAAAQIECDQrYBHT7NEZnACB8QXckQABAgQIECBAgAABArsJWMTs5udqAuMIuAsBAgQIECBAgAABAgQIdCFgEdPFMQ4XQmcCBAgQIECAAAECBAgQIECgnkDWRUy9hDoRIECAAAECBAgQIECAAAECWQVmN5dFzOyOXGACBAgQIECAAAECBAgQKIUBgeEEfvO33lB+741vPfQGFjGHsniSAAECBAgQIECAAAECAwloS4BA1wKxhHn7O95d3rC/iIk6GNYi5qCI7wkQIECAAAECBAh0KiAWAQIECAwrcP7CxXLuhjOXbxI/FXNwGWMRc5nHAwIECBAgQIAAgYEEtCVAgAABArMQOHf2THnszY8oT73tlst5YxkTtXzCImYp4SsBAgQIECDQoYBIBAgQIECAAIFxBQ5bxsRPxSyXMRYx456HuxEgQIDAXATkJECAAAECBAgQmK3AUcuYk7GRqVlvfus7SlTNnpl7RdaozDPWnC2yRtXsmblXZI3KPGPN2SJrVM2emXtF1qjMM24z26prImvUqtd7ez6yRvWWa1WeyBq16vWenn/v+z5w+UNdPO4p26oscbZRq17v7fnIGtVbrlV5ImvUqtd7ez6yRvWWa1WeyBq16vXeno+sUb3lWpUnskater235yNrVG+5VuWJrFGrXj/u+T/503eX87dfLGev+Dtj4idjTsYvNSuGjKrZM3OvyBqVecaas0XWqJo9M/eKrFGZZ6w5W2SN2rLn5b8VvJXrI2tUK/PuOmdkjdq1TyvXR9aoVubddc7IGrVrnxauj+XLchMTj1uYedcZ42yjdu3TyvWRNaqVeXedM7JG7dqnlesja1Qr8+46Z2SN2rVPK9dH1qhW5t11zsgatWufVq6PrFGtzLvrnJE1apc+8V9PurC/jFl+domv/mhSKKjGBYxPgAABAgQIECBAgAABAgTaEDgZf5NvzXrSLY8pUTV7pu112y2LrPLesvgboTOf07azxdlGbXt9a9dF1qjW5t523sgate31rV0XWaNam3vbeSNr1LbXt3ZdZI1qbe5t5n3oQ268/CkrHm/To7Vr4myjWpt723kja9S2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');
            background-size: 100% 100%;
            background-position: center;
            background-repeat: no-repeat;
        }

        #memo-pad {
            width: 100%;
            height: 100%;
            display: block;
            touch-action: none;
            user-select: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }

        #memo-question-overlay {
            position: absolute;
            top: calc(10px + env(safe-area-inset-top));
            left: 10px;
            right: 10px;
            background: var(--overlay-bg);
            color: var(--text-color);
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            pointer-events: none;
            /* ペン入力を邪魔しないように */
            display: none;
            z-index: 10;
            font-size: 0.9em;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
        }

        #eraser-cursor {
            position: absolute;
            width: 20px;
            height: 20px;
            border: 2px solid #555;
            background-color: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            pointer-events: none;
            display: none;
            transform: translate(-50%, -50%);
            z-index: 20;
            box-shadow: 0 0 2px rgba(0, 0, 0, 0.5);
        }

        .tool-btn {
            background: var(--btn-bg);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 0.9em;
            color: var(--btn-text);
            touch-action: manipulation;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
        }

        .tool-btn:hover:not(:disabled) {
            background: var(--btn-hover);
        }

        .tool-btn.active {
            background: var(--btn-active-bg);
            color: var(--btn-active-text);
            border-color: var(--btn-active-bg);
        }

        /* --- クイズ用スタイル (既存のスタイルを調整) --- */
        header {
            background-color: var(--header-bg);
            color: var(--header-text);
            padding: 10px;
            text-align: center;
            border-radius: 5px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.3s, color 0.3s;
        }

        header h1 {
            margin: 0;
            color: inherit;
            /* 親要素のcolorを継承 */
            font-size: 1.5em;
        }

        #quiz-container {
            min-height: 300px;
        }

        #progress-bar {
            width: 100%;
            height: 10px;
            background-color: var(--border-color);
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 15px;
            transition: background-color 0.3s;
        }

        #progress {
            width: 0%;
            height: 100%;
            background-color: #007bff;
            transition: width 0.3s ease-in-out;
        }

        #question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        #question-number {
            font-weight: bold;
            color: #007bff;
        }

        #score {
            font-weight: bold;
            color: #28a745;
        }

        #question-text {
            font-size: 1.2em;
            margin: 15px 0 25px 0;
            color: var(--text-color);
            transition: color 0.3s;
        }

        #options-container {
            display: none;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 20px;
        }

        #options-container.options-vertical {
            grid-template-columns: 1fr;
            gap: 10px;
        }

        .option-btn {
            padding: 15px;
            border: 2px solid var(--border-color);
            border-radius: 5px;
            background-color: var(--panel-bg);
            cursor: pointer;
            font-size: 1.0em;
            transition: all 0.3s;
            width: 100%;
            text-align: left;
            color: var(--text-color);
            touch-action: manipulation;
        }

        .option-btn:hover:not(:disabled) {
            background-color: var(--btn-hover);
            border-color: #007bff;
        }

        .option-btn:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .option-btn.correct {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
            font-weight: bold;
        }

        .option-btn.incorrect {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }

        .option-btn.incorrect.selected {
            opacity: 1;
            border-width: 3px;
        }

        #show-options-btn {
            display: none;
            margin: 20px auto;
            padding: 12px 30px;
            font-size: 1.1em;
            font-weight: bold;
            color: #fff;
            background-color: #17a2b8;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        #show-options-btn:hover {
            background-color: #138496;
        }

        #feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            display: none;
            border: 2px solid;
            background-color: var(--panel-bg);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }

        #feedback.correct-feedback {
            background-color: var(--correct-bg);
            border-color: var(--correct-color);
            color: var(--text-color);
        }

        #feedback.incorrect-feedback {
            background-color: var(--incorrect-bg);
            border-color: var(--incorrect-color);
            color: var(--text-color);
        }

        .close-modal:hover,
        .close-modal:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        /* リンクのスタイル */
        a {
            color: var(--link-color);
        }

        .speak-button {
            display: none;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2em;
            margin-left: 8px;
            padding: 2px 5px;
        }

        #next-btn,
        #results-btn {
            display: none;
            padding: 12px 25px;
            font-size: 1.1em;
            font-weight: bold;
            color: #fff;
            background-color: #007bff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            float: right;
            margin-top: 20px;
            transition: background-color 0.3s;
            touch-action: manipulation;
        }

        #next-btn:hover,
        #results-btn:hover {
            background-color: #0056b3;
        }

        #results-container {
            text-align: center;
            font-size: 1.4em;
            display: none;
            color: var(--text-color);
            transition: color 0.3s;
        }

        #results-container h2 {
            color: #007bff;
        }

        #homepage-link {
            display: inline-block;
            margin-top: 20px;
            padding: 12px 20px;
            background-color: #6c757d;
            color: #fff;
            text-decoration: none;
            border-radius: 5px;
            font-size: 1.1em;
        }

        #homepage-link:hover {
            background-color: #5a6268;
        }

        /* AI分析ボタン */
        .ai-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            margin-top: 10px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .ai-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(118, 75, 162, 0.4);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
        }

        /* AIバナー（ヘッダー用） */
        .ai-banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            display: inline-block;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            margin-bottom: 10px;
        }

        .explanation-banner {
            background: linear-gradient(135deg, #28a745 0%, #218838 100%);
            color: #fff;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            display: inline-block;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            margin-bottom: 10px;
        }

        /* モーダル */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: var(--panel-bg);
            padding: 20px;
            border-radius: 12px;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            max-height: 80vh;
            overflow-y: auto;
            overscroll-behavior: none;
            touch-action: pan-y;
            text-align: left;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            position: relative;
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }

        .close-modal {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 1.5em;
            cursor: pointer;
            color: #999;
        }

        /* Image Preview Modal */
        #image-preview-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        #image-preview-modal img {
            max-width: 90%;
            max-height: 70%;
            border: 2px solid #fff;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            margin-bottom: 20px;
        }

        #image-preview-modal .modal-controls {
            display: flex;
            gap: 15px;
        }

        #image-preview-modal button {
            padding: 10px 20px;
            font-size: 1em;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            transition: background 0.3s;
        }

        #image-preview-modal .close-btn {
            background: #6c757d;
            color: #fff;
        }

        #image-preview-modal .share-btn {
            background: #007bff;
            color: #fff;
        }

        #image-preview-modal .save-hint {
            color: #fff;
            margin-bottom: 15px;
            font-size: 1em;
            text-align: center;
            background: rgba(0, 0, 0, 0.5);
            padding: 5px 10px;
            border-radius: 4px;
        }

        /* ===== 追加：不正解時の2択（やり直す／正解を教えて） ===== */
        .wrong-decision-area {
            margin-top: 12px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .wrong-decision-btn {
            padding: 10px 18px;
            font-size: 1em;
        }

        .wrong-decision-note {
            margin-top: 8px;
            font-size: 0.85em;
            opacity: 0.8;
            text-align: center;
        }

        /* ===== 追加：励ましコメント（気持ちよさUP） ===== */
        /* ===== グラフ作成ツール用スタイル ===== */
        #btn-graph.active {
            background-color: #6610f2;
            color: white;
            border-color: #6610f2;
            box-shadow: 0 0 0 0.2rem rgba(102, 16, 242, 0.5);
        }

        .graph-guide {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(40, 40, 40, 0.9);
            color: #fff;
            padding: 8px 16px;
            border-radius: 20px;
            pointer-events: none;
            display: none;
            z-index: 100;
            font-weight: bold;
            font-size: 0.9em;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            white-space: nowrap;
        }

        #encouragement-under-question {
            margin: 12px auto 0 auto;
            padding: 8px 12px;
            border-radius: 10px;
            border: 1px dashed var(--border-color);
            background: var(--panel-bg);
            font-size: 0.98em;
            text-align: center;
            max-width: 95%;
            opacity: 0.92;
        }
    </style>
</head>

<body>
    <!-- 左パネル：クイズ -->
    <div id="left-panel">
        <header>
            <h1>第1節-6 2次関数のグラフ</h1>
            <div>
                <!-- <button id="fullscreen-toggle" class="tool-btn" onclick="toggleFullscreen()"
                        style="padding: 5px 10px; font-size: 1.2em;" title="フルスクリーン／フルスクリーン解除">⛶</button>--><button
                    id="dark-mode-toggle" class="tool-btn" style="padding: 5px 10px; font-size: 1.2em;"
                    title="ダークモード／ライトモード">🌙</button><button id="resume-toggle" class="tool-btn"
                    onclick="toggleResume()" style="padding: 5px 10px; font-size: 1.2em; display: none;"
                    title="途中保存機能のON/OFF">📂</button><button id="sound-toggle" class="tool-btn" onclick="toggleSound()"
                    style="padding: 5px 10px; font-size: 1.2em;" title="効果音の有／無">🔊</button>
            </div>
        </header>
        <main>
            <div id="quiz-container">
                <div id="progress-bar">
                    <div id="progress"></div>
                </div>
                <div id="question-header"><span id="question-number"></span><span id="score"></span></div>
                <h2 id="question-text"></h2>
                <div id="encouragement-under-question" style="display:none;"></div><button id="answer-btn"
                    class="tool-btn ai-btn"
                    style="display:block; margin: 20px auto; padding: 12px 30px; font-size: 1.2em;"
                    onclick="checkAnswerWithAI()">🤖AIカガワ先生🤖に添削してもらう</button>
                <div id="analyzing-indicator" style="display:none; text-align:center; margin: 10px 0;"><span
                        style="font-size: 2em;">🤖</span>採点中... </div>
                <div id="options-container" style="display:none;"></div>
                <div id="feedback"></div><button id="next-btn">次の問題へ</button><button id="results-btn">結果を見る</button>
            </div>
            <div id="results-container">
                <h2>テスト終了！</h2>
                <p id="score-text"></p>
                <p id="final-message"></p>
                <!-- 結果送信フォーム -->
                <!-- 結果送信フォーム -->
                <div
                    style="margin: 20px 0; padding: 15px; background: var(--panel-bg); border-radius: 8px; border: 1px solid var(--border-color);">
                    <p style="margin-bottom: 10px; font-size: 0.9em;">※名前とGAS URLはトップページで設定してください。</p>
                    <button class="tool-btn" onclick="sendResults()" style="background-color: #28a745; color: white;">📤
                        先生に送信</button>
                    <p id="send-status" style="margin-top: 5px; font-size: 0.9em; color: var(--text-color);">
                    </p>
                </div><button id="retry-btn"
                    style="display:none; margin: 10px auto; background-color: #ffc107; color: #000;" class="tool-btn"
                    onclick="retryIncorrect()">🔥 間違えた問題だけリトライ</button><br><a href="index.html"
                    id="homepage-link">トップページに戻る</a>
            </div>
        </main>
        <footer>
            <p>&copy;
                2025 [香川亮]</p>
        </footer>
    </div>
    <!-- リサイザー -->
    <div id="resizer"></div>
    <!-- 右パネル：メモパッド -->
    <div id="right-panel">
        <div id="memo-container">
            <div id="memo-question-overlay"></div>
            <div id="graph-guide" class="graph-guide">頂点をタップしてください</div>
            <div id="eraser-cursor"></div><canvas id="memo-pad"></canvas>
        </div>
        <div id="memo-toolbar">
            <div id="page-controls"><button id="prev-page-btn" class="page-btn" onclick="switchPage(-1)">◀</button><span
                    id="page-indicator">1 / 1</span><button id="next-page-btn" class="page-btn"
                    onclick="switchPage(1)">▶</button><button id="add-page-btn" class="page-btn" onclick="addNewPage()"
                    title="ページ追加">＋</button></div>
            <button id="btn-graph" class="tool-btn" onclick="setTool('graph')">📉 グラフ作成</button><button id="btn-pen"
                class="tool-btn active" onclick="setTool('pen')">🖊️ 黒</button><button id="btn-pen-red" class="tool-btn"
                onclick="setTool('pen-red')">🔴 赤</button><button class="tool-btn" id="btn-eraser"
                onclick="setTool('eraser')">🧽 消しゴム</button><button class="tool-btn active" id="btn-pen-only"
                onclick="togglePenOnly()">🖊️ ペンのみ</button><button class="tool-btn" onclick="undoMemo()">↩️
                元に戻す</button><span style="margin: 0 10px; color: #ccc;">|</span><button class="tool-btn"
                id="btn-toggle-question" onclick="toggleQuestionOverlay()">📖 問題を表示</button><button class="tool-btn"
                onclick="saveMemo()">💾 画像保存</button><button class="tool-btn" onclick="clearMemo()">🗑️
                メモを消去</button>
        </div>
    </div>
    </div>
    <!-- AI分析モーダル -->
    <div id="ai-modal" class="modal-overlay">
        <div class="modal-content"><span class="close-modal" onclick="closeAiModal()">&times;
            </span>
            <h3>🤖 AIカガワ先生の分析</h3>
            <div id="ai-content">
                <p>分析中...</p>
            </div>
        </div>
    </div>
    <!-- 画像プレビューモーダル -->
    <div id="image-preview-modal" style="display:none;">
        <div class="modal-content"
            style="text-align: center; background:transparent; box-shadow:none; border:none; color:white;">
            <img id="preview-image" src="" alt="メモのプレビュー"
                style="max-width:90%; border:2px solid #fff; border-radius:8px; margin-bottom:15px;">
            <div class="save-hint"
                style="margin-bottom:15px; background:rgba(0,0,0,0.5); padding:5px; border-radius:5px;">
                画像を長押しまたは右クリックして保存してください</div>
            <div class="modal-controls" style="justify-content:center;"><button class="tool-btn close-btn"
                    onclick="closeImagePreview()">閉じる</button></div>
        </div>
    </div>
    <script>
        // デバッグ用フラグ        // alert("Script Started Parsing"); // Verification alert

        // --- グローバル変数 ---
        let quizData = [];
        let incorrectQuestions = []; // 間違えた問題を格納
        let currentQuestionIndex = 0;
        let score = 0;
        let startTime; // 開始時間
        let isSoundOn = true; // 効果音ON/OFF
        let isDarkMode = false;
        let isResumeOn = false; // デフォルトでOFF

        // --- Dark Mode Logic ---
        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode');
            const btn = document.getElementById('dark-mode-toggle');

            if (isDarkMode) {
                btn.textContent = '☀️';
                localStorage.setItem('darkMode', 'true');
                currentPenColor = '#fff';
            }

            else {
                btn.textContent = '🌙';
                localStorage.setItem('darkMode', 'false');
                currentPenColor = '#000';
            }

            // リサイズして背景色更新などを反映
            resizeCanvas();
            // drawUserGraph()はキャンバスをクリアしてしまうため削除。
            // 必要ならグラフモード時のみ再描画する制御が必要だが、
            // ユーザーの手書きを守るためここでは再描画しない。
        }

        let currentPenColor = '#000'; // 現在のペンの色
        const synth = window.speechSynthesis;
        let currentUtterance = null;
        let audioCtx = null; // グローバルAudioContext

        // --- キャンバス関連 ---
        // --- AIのJSONを安全にパース（\subset などの不正エスケープを自動修復） ---
        function parseAIJsonWithRepair(rawText) {
            if (!rawText) throw new Error("Empty AI response");

            const trimmed = rawText.trim();

            // 余計な前後文が混ざっても最初の { から最後の } を拾う
            const match = trimmed.match(/\{[\s\S]*\}/);
            let jsonStr = match ? match[0] : trimmed;

            // まず素直にパース
            try {
                return JSON.parse(jsonStr);
            }

            catch (e1) {
                // JSONとして無効なバックスラッシュだけを \\ に修復
                // 例: "\subset" -> "\\subset"
                let repaired = jsonStr.replace(/\\(?!["\\/bfnrtu]|u[0-9a-fA-F]{4})/g,
                    '\\\\'
                );

                try {
                    return JSON.parse(repaired);
                }

                catch (e2) {
                    // 最終保険：全部の \ を \\ に（多少荒いが止血になる）
                    repaired = jsonStr.replace(/\\/g, '\\\\');
                    return JSON.parse(repaired);
                }
            }
        }

        let canvas;
        let ctx;
        let isDrawing = false;
        let currentTool = 'pen'; // 'pen', 'eraser', 'graph'
        let memoHistory = []; // Undo用履歴
        const MAX_HISTORY = 20;
        let isPenOnlyMode = true; // ペンのみモード（パームリジェクション）

        // --- グラフ作成機能用変数 ---
        let graphState = 'none'; // 'none', 'set-vertex', 'set-point', 'completed'
        let graphVertex = null; // {x, y} Logical
        let graphPoint = null; // {x, y} Logical
        let systemGraphData = null; // 描画データ保持用
        const SYSTEM_SCALE = 40; // 1 unit = 40px (大きくする)

        let SYSTEM_ORIGIN = {
            x: 0, y: 0
        }

            ; // Canvas center

        function updateSystemOrigin() {
            if (canvas) {
                SYSTEM_ORIGIN = {
                    x: canvas.width / 2, y: canvas.height / 2
                }

                    ;
            }
        }

        function logicalToCanvas(lx, ly) {
            return {
                x: SYSTEM_ORIGIN.x + lx * SYSTEM_SCALE,
                y: SYSTEM_ORIGIN.y - ly * SYSTEM_SCALE // Y flips
            }

                ;
        }

        function canvasToLogical(cx, cy) {
            return {
                x: (cx - SYSTEM_ORIGIN.x) / SYSTEM_SCALE,
                y: (SYSTEM_ORIGIN.y - cy) / SYSTEM_SCALE
            }

                ;
        }

        function snapToGrid(val) {
            // return Math.round(val); // 旧: 整数座標
            return Math.round(val * 10) / 10; // 新: 0.1刻み
        }

        // --- マルチページ管理 ---
        let memoPages = []; // { imageData: ImageData, graphData: { vertex, point, systemData } | null }
        let currentPageIndex = 0;

        function updatePageControls() {
            const indicator = document.getElementById('page-indicator');
            const prevBtn = document.getElementById('prev-page-btn');
            const nextBtn = document.getElementById('next-page-btn');

            // ページが空なら1ページ目を仮想的に扱う
            const total = Math.max(1, memoPages.length);
            const current = currentPageIndex + 1;

            indicator.textContent = `${current
                }

                / ${total
                }

                `;
            prevBtn.disabled = (currentPageIndex === 0);

            // 最後のページなら「次へ」は無効（追加ボタンで増やす）
            // ただし、ページ移動で戻っている場合は「次へ」が有効
            nextBtn.disabled = (currentPageIndex === memoPages.length - 1);
        }

        function saveCurrentPageToMemory() {
            // 現在のキャンバス状態（描画内容）を取得
            const currentImage = ctx.getImageData(0, 0, canvas.width, canvas.height);

            // 現在のグラフ状態
            const currentGraphData = (graphState !== 'none' && graphState !== 'pending') ? {
                state: graphState,
                vertex: graphVertex,
                point: graphPoint,
                systemData: systemGraphData
            }

                : null;

            // 配列に保存（存在しなければ新規、あれば上書き）
            memoPages[currentPageIndex] = {
                imageData: currentImage,
                graphData: currentGraphData
            }

                ;
        }

        function loadPageFromMemory(index) {
            // 現在のページを退避
            saveCurrentPageToMemory();

            // インデックス更新
            currentPageIndex = index;

            // ターゲット読み込み
            if (memoPages[index]) {
                const page = memoPages[index];

                // キャンバス復元
                if (page.imageData) {
                    ctx.putImageData(page.imageData, 0, 0);
                }

                else {
                    clearMemo();
                }

                // グラフ状態復元
                if (page.graphData) {
                    graphState = page.graphData.state;
                    graphVertex = page.graphData.vertex;
                    graphPoint = page.graphData.point;
                    systemGraphData = page.graphData.systemData;

                    // グラフツールを選択状態にするかどうかはUX次第だが、
                    // グラフデータがあるなら強制的にグラフモード＆再描画が親切か
                    if (graphState === 'completed' || graphState === 'set-vertex') {
                        // ツール切り替えせずに描画だけ復元するとペンモードでドラッグできてしまう等の矛盾が出る
                        // なので、グラフ状態がある場合はグラフモードに切り替える
                        setTool('graph');
                    }

                    else {
                        // データはあるが完了していない等は一旦リセット
                        resetGraphMode();
                        setTool('graph');
                    }
                }

                else {

                    // グラフデータがないページなら、グラフモードはリセット
                    // ツールはペンのままにするか？ -> 前のページのツールを引き継ぐかリセットするか
                    // ここでは「グラフモード」中に通常ページに来たら「ペン」に戻す
                    if (currentTool === 'graph') {
                        setTool('pen');
                    }

                    else {
                        // 既にペンならそのまま
                        resetGraphMode();
                    }
                }
            }

            else {
                // まだデータがない（新規ページなど）
                resetGraphMode();
                drawUserGraph(); // 初期グリッド描画
                alert("【グラフ作成モード】\n1. まず「頂点」をタップしてください。\n2. 次に「y切片」をタップしてグラフを描きます。\n※正誤判定には「頂点」と「y切点」の両方が正しいことが必要です。");
            }

            updatePageControls();

            // Undo履歴はページまたぐとややこしいのでクリアが安全
            memoHistory = [];
        }

        function switchPage(delta) {
            const newIndex = currentPageIndex + delta;

            if (newIndex >= 0 && newIndex < memoPages.length) {
                loadPageFromMemory(newIndex);
            }

            else if (newIndex === memoPages.length && delta === 1) {
                // 最後のページから次へを押した場合、新しいページを追加
                addNewPage();
            }
        }

        function addNewPage() {
            // 現在の状態を保存
            saveCurrentPageToMemory();

            // 新規ページ追加
            const newIdx = memoPages.length;

            // 空データ追加
            memoPages[newIdx] = {
                imageData: null, // load時にclearMemoされる
                graphData: null
            }

                ;

            // 移動
            loadPageFromMemory(newIdx);
        }

        // --- Missing Page Management Functions Restored ---
        function saveCurrentPageToMemory() {
            if (currentPageIndex >= 0 && currentPageIndex < memoPages.length) {
                // ImageData保存
                let img = null;

                if (canvas && canvas.width > 0 && canvas.height > 0) {
                    img = ctx.getImageData(0, 0, canvas.width, canvas.height);
                }

                memoPages[currentPageIndex] = {
                    imageData: img,
                    graphData: (graphState !== 'none') ? {
                        state: graphState,
                        vertex: graphVertex,
                        point: graphPoint,
                        systemData: systemGraphData
                    } : null
                };
            }
        }

        function loadPageFromMemory(index) {
            // 現在のページを保存してから移動
            // (呼び出し元でsaveCurrentPageToMemoryしている場合は重複するが安全側に倒す)
            saveCurrentPageToMemory();

            currentPageIndex = index;
            const pageData = memoPages[index];

            // Canvasクリア
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (pageData) {

                // 画像復元
                if (pageData.imageData) {
                    ctx.putImageData(pageData.imageData, 0, 0);
                }

                // グラフ状態復元
                if (pageData.graphData) {
                    graphState = pageData.graphData.state;
                    graphVertex = pageData.graphData.vertex;
                    graphPoint = pageData.graphData.point;
                    systemGraphData = pageData.graphData.systemData;
                }

                else {
                    resetGraphMode();
                }
            }

            else {
                // データがない場合は初期化
                resetGraphMode();
            }

            updatePageControls();

            // グラフモードならグリッド再描画（画像に含まれていない場合など）
            // 画像にグリッドが含まれているかどうか... drawUserGraphはclearRectするので、
            // グラフデータがあるならdrawUserGraphを呼ぶべき。
            // しかし手書き線が消える問題がある。
            // 仕様：グラフ作成モードで描いた線は「画像」として保存されるが、
            // 再編集可能にするには「状態」も必要。
            // load時に「グラフデータ有り」なら、再度drawUserGraphしないとグリッドが出ない？
            // -> drawUserGraphは全クリアして描くので、手書きが消える。
            // -> よって、画像として保存されているものを優先し、編集時のみ再描画などの制御が必要。
            // ひとまず画像優先。
        }

        function initMultiPage() {
            memoPages = [];
            currentPageIndex = 0;
            // 1ページ目を確保
            if (ctx && canvas) {
                memoPages.push({
                    imageData: ctx.getImageData(0, 0, canvas.width, canvas.height),
                    graphData: null
                });
            }
            updatePageControls();
        }

        function resetMemoPad() {
            clearMemo();
            memoHistory = [];
            initMultiPage(); // マルチページ初期化
        }

        // DOMContentLoadedだとKaTeXのスクリプト読み込み(CDN)が完了していない可能性があるため、
        // window loadイベントで初期化を行う。
        document.addEventListener("DOMContentLoaded", function () {
            initAudioContext(); // オーディオコンテキストの初期化準備
            initCanvas();
            setTimeout(resizeCanvas, 100); // レイアウト確定後に再調整
            initQuiz();
            // ダークモード設定を読み込む
            const savedDarkMode = localStorage.getItem('darkMode');

            if (savedDarkMode === 'true') {
                isDarkMode = true;
                document.body.classList.add('dark-mode');
                document.getElementById('dark-mode-toggle').textContent = '☀️';
                document.getElementById('dark-mode-toggle').textContent = '☀️';
                currentPenColor = '#fff'; // ペンの色を白に設定
            }

            // ダークモード切り替えイベントリスナー
            document.getElementById('dark-mode-toggle').addEventListener('click', toggleDarkMode);

            // レジューム設定を読み込む (一時的に無効化)
            // const savedResume = localStorage.getItem('resumeOn');
            // if (savedResume !== null) {
            //     isResumeOn = (savedResume === 'true');
            // }
            updateResumeButton();

            // 全体スクロール防止（左パネルとモーダル以外）
            document.addEventListener('touchmove', function (e) {

                // 左パネル、モーダル、またはツールバー内の要素（ボタンなど）での操作は許可
                if (!e.target.closest('#left-panel') && !e.target.closest('.modal-content') && !e.target.closest('#memo-toolbar')) {
                    e.preventDefault();
                }
            }

                , {
                    passive: false
                });


            // --- 積極的なオーディオプリロード（遅延対策） ---
            document.addEventListener('touchstart', function (e) {
                if (e.target.closest('.option-btn') || e.target.closest('#next-btn') || e.target.closest('#results-btn')) {
                    if (isSoundOn) {
                        try {
                            const AudioContext = window.AudioContext || window.webkitAudioContext;

                            if (!audioCtx && AudioContext) {
                                audioCtx = new AudioContext();
                            }

                            if (audioCtx && audioCtx.state === 'suspended') {
                                audioCtx.resume();
                            }
                        }

                        catch (err) {
                            console.error("Audio warmup failed:", err);
                        }
                    }
                }
            }

                , {
                    passive: true
                });

            // --- Event Listeners for Quiz Flow (Restored) ---
            document.getElementById('next-btn').addEventListener('click', () => {
                playSe('button');
                currentQuestionIndex++;

                if (currentQuestionIndex < quizData.length) {
                    loadQuestion();
                    document.getElementById('feedback').style.display = 'none';
                    document.getElementById('next-btn').style.display = 'none';
                    document.getElementById('answer-btn').style.display = 'block';
                    document.getElementById('answer-btn').textContent = "🤖AIカガワ先生🤖に添削してもらう";
                    document.getElementById('encouragement-under-question').style.display = 'none';


                    // 上までスクロール
                    window.scrollTo({
                        top: 0, behavior: 'smooth'
                    });
                }
            });

            document.getElementById('results-btn').addEventListener('click', () => {
                playSe('button');
                document.getElementById('quiz-container').style.display = 'none';
                document.getElementById('results-container').style.display = 'block';

                const scoreText = document.getElementById('score-text');
                const finalMessage = document.getElementById('final-message');
                const percentage = Math.round((score / quizData.length) * 100);

                scoreText.innerHTML = `<span style="font-size: 3em; color: #007bff;" >${score
                    }

                </span> / ${quizData.length
                    }

                問正解 (${percentage
                    }

                    点)`;

                if (percentage >= 80) {
                    finalMessage.textContent = "素晴らしい！マスターレベルです！";
                    if (window.confetti) confetti();
                }

                else if (percentage >= 60) {
                    finalMessage.textContent = "惜しい！あと少しで完璧です。";
                }

                else {
                    finalMessage.textContent = "復習してもう一度チャレンジしましょう！";
                }

                if (incorrectQuestions.length > 0) {
                    document.getElementById('retry-btn').style.display = 'block';
                }
            });
        });

        // --- クイズ初期化 ---
        function initQuiz() {
            try {
                // KaTeX設定
                const katexDelimiters = [
                    { left: '$$', right: '$$', display: true },
                    { left: '$', right: '$', display: false },
                    { left: '\\(', right: '\\)', display: false },
                    { left: '\\[', right: '\\]', display: true }
                ];

                const renderMath = () => {
                    if (window.renderMathInElement) {
                        renderMathInElement(document.body, {
                            delimiters: katexDelimiters, throwOnError: false
                        });
                    } else {
                        setTimeout(renderMath, 100);
                    }
                };
                renderMath();

                // データ読み込み (window.QUIZ_DATA from M1-1-1-1QD.js)
                let allData = [];
                if (window.QUIZ_DATA) {
                    allData = window.QUIZ_DATA;
                } else if (typeof allQuizData !== 'undefined') {
                    allData = allQuizData; // フォールバック
                }

                if (!allData || allData.length === 0) {
                    document.getElementById('question-text').innerText = "問題データが見つかりません。";
                    return;
                }

                // レジューム機能：保存されたデータがあるか確認
                const urlParams = new URLSearchParams(window.location.search);
                const isReset = urlParams.get('reset') === 'true';

                if (isReset) {
                    const newUrl = window.location.pathname + window.location.hash;
                    window.history.replaceState(null, '', newUrl);
                } else if (isResumeOn) {
                    const savedData = localStorage.getItem('quiz_progress_M1-3-1-6');
                    if (savedData) {
                        if (confirm("前回の続きから始めますか？")) {
                            restoreProgress(JSON.parse(savedData));
                            return;
                        } else {
                            localStorage.removeItem('quiz_progress_M1-3-1-6');
                        }
                    }
                }

                // グループ対応のデータ読み込み (M1-2-3-2方式)
                const rawData = [...allData];
                // シャッフル
                rawData.sort(() => 0.5 - Math.random());

                // 上位5グループ（計10問）
                const selectedItems = rawData.slice(0, 5);

                quizData = [];

                selectedItems.forEach((item, groupIndex) => {
                    if (item.type === 'group') {
                        const mainQ = item.mainQuestion;
                        if (item.subQuestions) {
                            item.subQuestions.forEach(sub => {
                                quizData.push({
                                    groupId: `group-${groupIndex}`, // Add group ID
                                    question: mainQ + "<br>" + sub.question,
                                    answer: sub.answer,
                                    rationale: sub.rationale,
                                    answerType: sub.answerType || 'text'
                                });
                            });
                        } else {
                            console.warn("Group item missing subQuestions:", item);
                        }
                    } else {
                        quizData.push({
                            ...item,
                            groupId: `single-${groupIndex}` // Unique ID for non-groups
                        });
                    }
                });

                startTime = Date.now(); // タイマー開始
                loadQuestion();

            } catch (e) {
                alert("初期化エラー: " + e.message);
                console.error(e);
            }
        }

        // --- クイズロジック ---
        function loadQuestion() {
            const quizContainer = document.getElementById('quiz-container');
            const resultsContainer = document.getElementById('results-container');
            const feedbackEl = document.getElementById('feedback');
            const nextBtn = document.getElementById('next-btn');
            const resultsBtn = document.getElementById('results-btn');
            const optionsContainer = document.getElementById('options-container');
            const showOptionsBtn = document.getElementById('show-options-btn');
            const questionNumberEl = document.getElementById('question-number');
            const questionTextEl = document.getElementById('question-text');

            if (currentQuestionIndex >= quizData.length) return;

            const currentQuestion = quizData[currentQuestionIndex];
            const previousQuestion = (currentQuestionIndex > 0) ? quizData[currentQuestionIndex - 1] : null;
            // groupId が同じなら同じ大問の小問とみなす
            const isSameGroup = previousQuestion && currentQuestion.groupId && (previousQuestion.groupId === currentQuestion.groupId);

            // リセット (グループが変わった時だけ)
            feedbackEl.style.display = 'none';
            nextBtn.style.display = 'none';

            if (!isSameGroup) {
                resetMemoPad(); // メモをリセット (includes initMultiPage)
                // initMultiPage was called, but we ensure page 0 is set
                // If initMultiPage already did it, we might be double-doing, but initMultiPage is safe.
            } else {
                // If same group, we keep the pages.
            }

            updatePageControls();

            document.getElementById('feedback').style.display = 'none';
            document.getElementById('analyzing-indicator').style.display = 'none';

            // メモの「問題を表示」をリセット
            document.getElementById('memo-question-overlay').style.display = 'none';
            document.getElementById('btn-toggle-question').classList.remove('active');

            updateProgressAndScore();
            saveProgress(); // 進行状況を保存

            // DEBUG: Check data integrity
            // alert(`Debug: Index=${currentQuestionIndex}, DataLen=${quizData.length}\ncurrentQuestion=${JSON.stringify(currentQuestion)}`);

            if (!currentQuestion) {
                alert("エラー: 問題データがありません (currentQuestion is undefined)");
                return;
            }

            questionNumberEl.textContent = `問題 ${currentQuestionIndex + 1} / ${quizData.length}`;

            // Verify element existence
            if (!questionTextEl) {
                alert("エラー: question-text 要素が見つかりません");
                return;
            }

            questionTextEl.innerHTML = currentQuestion.question;

            // メモパッド上の問題文更新
            document.getElementById('memo-question-overlay').innerHTML = `<strong>問題 ${currentQuestionIndex + 1}:</strong><br>${currentQuestion.question}`;

            // --- AnswerTypeによるUI制御 (追加) ---
            const graphBtn = document.getElementById('btn-graph');
            const memoContainer = document.getElementById('memo-container');

            // 確実にリセット
            if (memoContainer) {
                // 一旦全てクリアしてから必要な場合のみ再設定
                memoContainer.style.background = 'none';
                memoContainer.style.backgroundImage = 'none';
            }

            if (currentQuestion.answerType === 'graph') {
                // (2) グラフ描画問題：グラフ作成ボタンを表示
                if (graphBtn) graphBtn.style.display = '';

                if (memoContainer) {
                    // CSSでの背景指定を確実に打ち消す
                    memoContainer.style.backgroundImage = 'none';
                    memoContainer.style.background = 'none';
                    // もしクラスで背景が指定されているならクラスも削除すべき
                    memoContainer.classList.remove('graph-active');
                }

                // ユーザー要望：最初は軸を出さない -> ペンモードかつ背景なし
                setTool('pen');
            }

            else {
                // (1) 頂点計算など
                if (graphBtn) graphBtn.style.display = 'none';

                if (memoContainer) {
                    memoContainer.style.backgroundImage = 'none';
                    memoContainer.style.background = 'none';
                }

                setTool('pen');
            }

            // 描画タイミングの確保
            setTimeout(() => {
                renderAllMath();
            }

                , 50);
        }


        // --- 不正解時の分岐（もう一度解く／正解を教えて） ---
        let pendingAIResult = null; // { questionIndex, recognizedAnswer, feedback }

        // --- 励ましコメント（気持ちよさUP） ---
        const ENCOURAGEMENTS = ["OK！今の気づきを活かしてもう一度いこう。",
            "ナイス判断。ここでやり直せるのが強い。",
            "大丈夫。1回目で気づけたのが収穫！",
            "落ち着いていけば必ず取れる。",
            "今のミスは伸びしろ。次で回収しよう。",
            "いいね。ここからが本番。",
            "書き直してみよう。答えに近づいてるよ。"
        ];

        function showEncouragement() {
            const el = document.getElementById("encouragement-under-question");
            if (!el) return;
            const msg = ENCOURAGEMENTS[Math.floor(Math.random() * ENCOURAGEMENTS.length)];
            el.textContent = msg;
            el.style.display = "block";
        }

        function hideEncouragement() {
            const el = document.getElementById("encouragement-under-question");
            if (!el) return;
            el.style.display = "none";
            el.textContent = "";
        }

        function showWrongDecisionUI(currentQuestion, result) {
            const feedbackEl = document.getElementById('feedback');
            const nextBtn = document.getElementById('next-btn');
            const resultsBtn = document.getElementById('results-btn');
            const answerBtn = document.getElementById('answer-btn');

            nextBtn.style.display = 'none';
            resultsBtn.style.display = 'none';
            answerBtn.style.display = 'none';

            pendingAIResult = {
                questionIndex: currentQuestionIndex,
                recognizedAnswer: result.recognizedAnswer || '',
                feedback: result.feedback || ''
            }

                ;

            feedbackEl.className = 'incorrect-feedback';

            feedbackEl.innerHTML = ` <div class="ai-banner" >🤖AIカガワ先生🤖の解答check✅</div><br> <span style="color: var(--incorrect-color);" ><strong>今回は不正解でした。</strong></span><br> ${pendingAIResult.recognizedAnswer ? `<div style = "background:#f8f9fa; padding:10px; border-radius:5px; margin:10px 0;" ><span style="font-size:0.9em; color:#666;" >あなたの解答:</span><br>$$${pendingAIResult.recognizedAnswer
                }

                $$</div>` : '（解答なし/グラフ描画）<br>'
                }

            <div class="wrong-decision-area" > <button class="tool-btn ai-btn wrong-decision-btn" onclick="retryCurrentQuestion()" >🔁 もう一度解く</button> <button class="tool-btn ai-btn wrong-decision-btn" onclick="revealCorrectWithAI()" >✅ 正解を教えて！AIカガワ先生</button> </div> <div class="wrong-decision-note" >※「もう一度解く」を選ぶと，メモを消して解き直せます。</div> `;
            feedbackEl.style.display = 'block';
            renderAllMath();
        }

        function retryCurrentQuestion() {
            pendingAIResult = null;

            resetMemoPad(); // リトライ時はメモパッドをリセット

            const feedbackEl = document.getElementById('feedback');
            const answerBtn = document.getElementById('answer-btn');
            const indicator = document.getElementById('analyzing-indicator');
            const nextBtn = document.getElementById('next-btn');
            const resultsBtn = document.getElementById('results-btn');

            feedbackEl.style.display = 'none';
            indicator.style.display = 'none';
            nextBtn.style.display = 'none';
            resultsBtn.style.display = 'none';

            answerBtn.textContent = "🤖AIカガワ先生🤖に添削してもらう";
            answerBtn.style.display = 'block';

            showEncouragement();
        }

        function revealCorrectWithAI() {
            if (!pendingAIResult) return;

            const feedbackEl = document.getElementById('feedback');
            const nextBtn = document.getElementById('next-btn');
            const resultsBtn = document.getElementById('results-btn');

            const q = quizData[pendingAIResult.questionIndex] || quizData[currentQuestionIndex];

            if (!incorrectQuestions.includes(q)) {
                incorrectQuestions.push(q);
            }

            let html = ` <div class="ai-banner" >🤖AIカガワ先生🤖の解答check✅</div><br> <span style="color: var(--incorrect-color);" ><strong>今回は不正解でした。</strong></span><br> ${pendingAIResult.recognizedAnswer ? `<div style = "background:#f8f9fa; padding:10px; border-radius:5px; margin:10px 0;" ><span style="font-size:0.9em; color:#666;" >あなたの解答:</span><br>$$${pendingAIResult.recognizedAnswer
                }

                $$</div>` : '（解答なし/グラフ描画）<br>'
                }

            <strong>正解: ${q.answer
                }

            </strong><br><br> `;

            if (pendingAIResult.feedback) {
                html += `${pendingAIResult.feedback
                    }

                <br>`;
            }

            html += `<hr><div class="explanation-banner" >解説</div><br>${q.rationale || ""
                }

            `;

            feedbackEl.className = 'incorrect-feedback';
            feedbackEl.innerHTML = html;
            feedbackEl.style.display = 'block';
            renderAllMath();

            if (pendingAIResult.questionIndex < quizData.length - 1) {
                nextBtn.style.display = 'block';
                resultsBtn.style.display = 'none';
            }

            else {
                nextBtn.style.display = 'none';
                resultsBtn.style.display = 'block';
            }

            pendingAIResult = null;

            saveProgress();
            updateProgressAndScore();
        }

        async function checkAnswerWithAI() {
            const answerBtn = document.getElementById('answer-btn');
            const indicator = document.getElementById('analyzing-indicator');
            const feedbackEl = document.getElementById('feedback');
            const nextBtn = document.getElementById('next-btn');
            const resultsBtn = document.getElementById('results-btn');

            hideEncouragement();
            pendingAIResult = null;

            answerBtn.style.display = 'none';
            indicator.style.display = 'block';

            // iOS対策: ユーザー操作の直後にAudioContextを再開する
            if (isSoundOn && audioCtx) {
                if (audioCtx.state === 'suspended') {
                    audioCtx.resume();
                }
            }

            else if (isSoundOn && !audioCtx) {
                const AudioContext = window.AudioContext || window.webkitAudioContext;

                if (AudioContext) {
                    audioCtx = new AudioContext();
                    audioCtx.resume();
                }
            }

            const apiKey = localStorage.getItem('gemini_api_key');

            if (!apiKey) {
                alert("APIキーが設定されていません。トップページで設定してください。");
                indicator.style.display = 'none';
                answerBtn.style.display = 'block';
                return;
            }

            // --- 白紙チェック ---
            const memoPad = document.getElementById('memo-pad');

            if (typeof isCanvasBlank === 'function' && isCanvasBlank(memoPad)) {
                indicator.style.display = 'none';
                playSound('incorrect');

                const feedbackEl = document.getElementById('feedback');

                feedbackEl.className = 'incorrect-feedback';
                feedbackEl.innerHTML = ` <div class="ai-banner" >🤖AIカガワ先生🤖の解答check✅</div><br> <span style="color: var(--incorrect-color);" ><strong>メモが白紙のようです💦</strong></span><br> メモ帳に記述がない場合は分析ができないので，解答はメモ帳に書いてくださいね！<br> <div class="wrong-decision-area" > <button class="tool-btn ai-btn wrong-decision-btn" onclick="retryCurrentQuestion()" >🔁 もう一度解く</button> </div> `;
                feedbackEl.style.display = 'block';
                return;
            }


            const currentQuestion = quizData[currentQuestionIndex];

            try {
                // --- マルチキャプチャ (全ページ結合) ---
                // 現在のページを保存
                saveCurrentPageToMemory();

                // 結合用キャンバス作成
                const w = canvas.width;
                /* CORRUPTED BLOCK COMMENTED OUT FOR DEBUG
                // 結合用キャンバス作成
                const w = canvas.width;
                const h = canvas.height;
                // pages: memoPagesにある画像データ
                const totalPages = memoPages.length;
                const stitchedCanvas = document.createElement('canvas');
                stitchedCanvas.width = w;
                stitchedCanvas.height = h * totalPages;
                const sCtx = stitchedCanvas.getContext('2d');

                // 背景
                sCtx.fillStyle = isDarkMode ? '#121212' : '#ffffff';
                sCtx.fillRect(0, 0, stitchedCanvas.width, stitchedCanvas.height);

                memoPages.forEach((page, i) => {
                     // 画像描画
                    if (page.imageData) {
                        const tmp = document.createElement('canvas');
                        tmp.width = w;
                        tmp.height = h;
                        tmp.getContext('2d').putImageData(page.imageData, 0, 0);
                        sCtx.drawImage(tmp, 0, i * h);
                        // ページ番号透かし
                        sCtx.font = "20px sans-serif";
                        sCtx.fillStyle = isDarkMode ? '#444' : '#ddd';
                        sCtx.fillText(`Page ${i + 1}`, 10, i * h + 30);
                    }
                });
                */
                const stitchedCanvas = canvas; // Fallback to single canvas for now

                const imageData = stitchedCanvas.toDataURL('image/png').split(',')[1];

                // グラフシステムデータの収集（全ページ分）
                // 複数のグラフがある場合は、最後の有効なグラフデータを優先するか、
                // 全て送るかだが、今回は「Page 2がグラフ」などの前提があるため、有効な最初のデータを送るか、全て送る
                // ここでは単純に「有効なグラフデータ」があればそれを送る
                let activeSystemGraphData = null;

                // 後ろのページから探す（最新のグラフを優先）
                for (let i = memoPages.length - 1; i >= 0; i--) {
                    if (memoPages[i].graphData && memoPages[i].graphData.systemData) {
                        activeSystemGraphData = memoPages[i].graphData.systemData;
                        break;
                    }
                }

                let prompt = `あなたは高校数学の「誤り診断」に特化した添削者です。
以下の問題に対する生徒の手書き解答（画像）を読み取り，
最終答案の正誤と，途中式の数学的整合性だけを判定してください。
画像は複数のメモ帳ページを縦に結合したものです（Page 1, Page 2...）。
問題: ${currentQuestion.question}

正解: ${currentQuestion.answer}

解説(参考): ${currentQuestion.rationale}

【問題の種類】 ${currentQuestion.answerType === 'graph' ? 'グラフ描画問題' : '数式計算/記述問題'}

${(activeSystemGraphData && currentQuestion.answerType === 'graph') ? `【重要：システム記録されたグラフ座標データ】
ユーザーは「グラフ作成ツール」を使用して以下の座標を指定しました。
これらの座標数値が、正解データ（頂点およびy切片）と一致するか厳密に判定してください。
- ユーザー指定の頂点: ${activeSystemGraphData.vertex}
- ユーザー指定の通過点(y切片): ${activeSystemGraphData.point}

判定ルール（グラフ問題）:
0. 【最重要】画像にユーザーの手書きやグラフ描画が全く見当たらない（白紙、またはグリッドのみ）場合は、絶対に「不正解」と判定し、isCorrect: false を返してください。「回答が見当たりません」と指摘してください。
1. 「ユーザー指定の頂点」が正解の頂点と一致するか。
2. 「ユーザー指定の通過点」が正解のy切片座標(0, c) と一致するか。
※両方が一致している場合のみ、グラフ描画は「正解」と判定してください。
※座標数値が分数の場合：以下の **いずれか** を満たせば必ず「正解」と判定してください。
1. **整数区間の一致**: 正解の座標 $X$ がある整数 $N$ と $N+1$ の間にあるとき（ $N \le X < N+1$ ）、ユーザーの入力 $x$ も同じ区間（ $N \le x < N+1$ ）にあれば正解（例: 正解 $-2.25$ は $-3$ と $-2$ の間。入力もその間にあれば正解）。
2. **数値の誤差**: 数値の差が $0.5$ 以内（ $|X - x| \le 0.5$ ）なら正解。
**強い指示**: AIは「ズレ」を指摘したがりますが、この問題では「正しい区間に点が打たれているか」だけを重視してください。「値が違う」という理由で不正解にしないでください。
3. **通過点の判定（最重要の変更点）**:
   - **非常に重要**: ユーザーが指定した点が「y切片」でなくても、**絶対に不正解にしないでください**。
   - 正解の2次関数式に代入して成立する点（誤差考慮）なら、**それがどの点であっても100%「正解」**としてください。
   - AIが「y切片を選んでください」と指摘して不正解にすることは**固く禁止**します。
   - 「別の正しい点を選んでいるので正解です」「計算して通る点を見つけられていて素晴らしい」と**称賛**してください。` : ''}

${(currentQuestion.answerType !== 'graph') ? `【判定ルール（計算 / 記述問題）】
0. 【最重要】画像にユーザーの手書きが全く見当たらない（白紙）場合は、絶対に「不正解」と判定し、isCorrect: false と返してください。「回答が見当たりません」と指摘してください。
1. グラフシステムデータは無視してください（もし含まれていても）。
2. メモ帳に書かれた計算過程と解答が、正解と一致しているか確認してください。
3. 文字式や座標の記述を優先して採点します。` : ''}

【共通判定ルール】
1. システムデータがない場合、または計算問題の場合は、画像認識で記述内容を判定してください。
2. グラフ問題でシステムデータがない場合は、手書きされたグラフの概形（頂点の位置象限、軸の位置、凸の向き）で判定してください。
【以下共通ルール】
1. 画像に何も書かれていない，または白紙に近い場合は必ず不正解とする。
2. その場合は以下のJSONのみを出力して終了する：
{"isCorrect": false, "hasProcessError": false, "recognizedAnswer": "", "feedback": "メモ帳に記述がない場合は分析ができないので，解答はメモ帳に書いてくださいね！"}

3. 最終答案が正解と一致している場合のみ isCorrect を true とする。
- 有理化で同じ，同値変形，積の順序違いなどは正解扱い。
- 途中式に誤りがあるかどうかは isCorrect ではなく hasProcessError で判定し，誤りがあれば必ず hasProcessError を true にすること。
4. 途中式が存在する場合は，必ず全ての途中式の整合性をチェックする。
- 1 行ごと，または意味のまとまりごとに，「前の行と論理的につながっているか」「左辺と右辺が本当に等しいか／同値か」を確認する。
5. 最終答案が正解でも途中式に数学的な誤りや飛躍がある場合，hasProcessError を true とし，feedback で短く指摘する。
- 1 行ごと，または意味のまとまりごとに，「前の行と論理的につながっているか」「左辺と右辺が本当に等しいか／同値か」を確認する。
- 途中に誤った式や不正確な同値変形が 1 回でもあれば，「細かいからいいか」と見逃さずに hasProcessError を true にする。
6. 途中式がほぼ無い，または文字がつぶれて読めない場合は，hasProcessError を false にしてよいが，feedback に「途中式が読み取れないため過程の検証は不十分」と短く書く。
7. 間違いの要因として「計算ミス」だけでなく「数式の写し間違い（問題文の式や条件の転記ミス）」も重要な誤りとして扱う。
- 特に，問題文の式や条件を書き写している最初の数行については，符号・係数・指数・不等号の向きなどの違いがないかを優先的にチェックし，誤りがあれば「写し間違い」として指摘する。
8. 正誤判定問題（答えが「正しい」「正しくない」の場合）について:
- 漢字の崩れやひらがな表記（例：「ただしい」）でも意図が明確なら採点する。
- 「〇」「×」はそれぞれ「正しい」「正しくない」に対応させて採点する。
9. 数式は必ずLaTeX形式（$...$）で記述する。分数は \\frac{a}{b} を用いる。
集合記号（\\subset, \\subseteq, \\supset, \\supseteq, \\in, \\notin, \\cup, \\cap, \\emptyset など）も必ず $...$ の中に入れる。
例：「AはBの部分集合なので $A \\subset B$」。
10. JSON出力時、文字列内のバックスラッシュは必ずエスケープして「\\\\」と記述してください。
（例：「\\\\{」ではなく「\\\\\\\\{」）

【背理法などの証明問題に関する追加ルール】
- 解答が背理法を用いている場合は，次の 4 点を必ず確認しなさい。
1. 証明したい命題の「否定」を，はっきり仮定しているか。
2. その仮定のもとで，正しい式変形・論理展開を行っているか。
3. 仮定と矛盾する内容（大小関係の矛盾，偶奇や整数性の矛盾など）を明確に導いているか。
4. 「仮定が誤り → 元の命題が成り立つ」という結論を，最後に明示しているか。
- 上のいずれかが欠けている場合は，最終的な結論の文言が正しくても，hasProcessError を true とし，論証として不十分であることを feedback で短く指摘しなさい。

【feedbackの書き方（やさしく・原因も意識して短く）】
- 50〜120字程度。
- 指摘は最大2点まで。
- 解説や模範解答の再提示は禁止（解説は別に表示される）。
- できる限り，次の2つをセットで簡潔に書きなさい：
1. どの行・どの式でどんな誤りがあったか（表面的な誤り）
2. その背景にありそうな原因の推測（〜かもしれません，もしかして〜など）
- 誤りタイプの例：計算ミス／符号ミス／公式の適用条件ミス／同値変形の誤り／論理の飛躍／写し間違い
- 原因が確実に特定できる場合は断定してよいが，完全には特定できない場合は，「〜かもしれません」「〜の可能性があります」「もしかして〜してしまったかな？」など，推測であることが分かるやわらかい表現を用いなさい。
例：
- 「2行目で $-3$ を $+3$ としているので符号ミスかもしれません。」
- 「解説で使っている公式の形をうろ覚えで適用してしまった可能性があります。」
- 不正解の場合は，最も致命的な誤り箇所を優先して指摘し，可能であれば「なぜそう書いてしまったか」の推測も一言そえる。
- 正解だが hasProcessError が true の場合は「答えは合っていますが，途中式に誤りが見られます。」のように，答えは認めつつ過程の問題とその原因の推測を短く指摘する。
- 正解かつ途中式にも問題がない場合のみ，feedback を空文字にする。

【出力】
以下のJSON形式のみを出力してください。Markdownのコードブロックは不要です。
{
    "isCorrect": true または false,
    "hasProcessError": true または false,
    "recognizedAnswer": "画像から読み取った生徒の最終解答（LaTeX $...$）。読み取れない場合は空文字。",
    "feedback": "誤り診断コメント。正解かつ過程も問題なければ空文字。"
}
`; prompt += ` 【グラフ描画問題の採点基準（重要）】 正解データには「頂点」「y切片（または通過点）」「グラフの形状（凸の向き）」が含まれています。 生徒の解答（画像）を以下の基準で厳密かつ柔軟に採点してください。 1. **頂点座標の記述チェック**: - 生徒はグラフ用紙の余白などに**頂点の座標を数値（分数含む）で記述**しているはずです。 - この記述された数値が正解と一致しているか確認してください。記述がない場合は減点対象としてfeedbackで指摘してください。 2. **グラフ描画の判定（位置の許容範囲）**: - **頂点の位置**: 頂点座標が整数の場合は、グリッド上の正しい位置にあるか厳密に見てください。 ただし、座標が**分数（小数）**の場合（例：$3/2=1.5$）、厳密な位置でなくても、**正しい整数区間**（例：$1$ と $2$ の間）にプロットされていれば「正解」とみなしてください。 - **y切片の位置**: 同様に、y切片が分数の場合も、**正しい整数区間**（例：$-5/2=-2.5$ なら $-2$ と $-3$ の間）を通っていれば「正解」としてください。 - **凸の向き**: 上に凸か下に凸かは厳密に判定してください。 `;

                prompt += ` 【最重要ルール】 0. 【最重要】画像にユーザーの手書きが全く見当たらない（白紙）場合は、絶対に「不正解」と判定し、isCorrect: false を返してください。「回答が見当たりません」と指摘してください。 1. 画像に何も書かれていない，または白紙に近い場合は必ず不正解とする。 2. その場合は以下のJSONのみを出力して終了する： {
                            "isCorrect": false, "hasProcessError": false, "recognizedAnswer": "", "feedback": "メモ帳に記述がない場合は分析ができないので，解答はメモ帳に書いてくださいね！"
                        }

                        3. 最終答案が正解と一致している場合のみ isCorrect を true とする。 - 有理化で同じ，同値変形，積の順序違いなどは正解扱い。 4. 途中式が存在する場合は，必ず途中式の整合性をチェックする。 5. 最終答案が正解でも途中式に数学的な誤りや飛躍がある場合， hasProcessError を true とし， feedback で短く指摘する。 6. 途中式がほぼ無い/読めない場合は hasProcessError を false にしてよいが， feedback に「途中式が読み取れないため過程の検証は不十分」と短く書く。 7. 間違いの要因として「計算ミス」だけでなく 「数式の写し間違い（問題文の式や条件の転記ミス）」も重要な誤りとして扱い， 可能なら優先して指摘する。 8. 正誤判定問題（答えが「正しい」「正しくない」の場合）について: - 漢字の崩れやひらがな表記（例：「ただしい」）でも意図が明確なら採点。 - 「〇」「×」はそれぞれ「正しい」「正しくない」に対応させて採点。 9. 数式は必ずLaTeX形式（$...$）で記述する。分数は \\frac {
                            a
                        }

                            {
                            b
                        }

                        を用いる。 集合記号（\subset, \subseteq, \supset, \supseteq, \in, \notin, \cup, \cap, \emptyset など）も 必ず $...$ の中に入れる。 例：「AはBの部分集合なので $A \subset B$」。 10. JSON出力時、文字列内のバックスラッシュは必ずエスケープして「\\」と記述してください。（例：「\{」ではなく「\\ {
                            」） 【feedbackの書き方（やさしく短く）】 - 50〜120字程度。 - 指摘は最大2点まで。 - 解説や模範解答の再提示は禁止（解説は別に表示される）。 - 誤りタイプの例： 計算ミス／符号ミス／公式の適用条件ミス／同値変形の誤り／論理の飛躍／写し間違い - 不正解の場合は最も致命的な誤り箇所を優先して指摘。 - 正解だが hasProcessError が true の場合は 「答えは合っていますが，途中式に誤りが見られます。」のように自然な表現で短く指摘。 【出力】 以下のJSON形式のみを出力してください。Markdownのコードブロックは不要です。 {
                                "isCorrect": true または false,
                                "hasProcessError": true または false,
                                "recognizedAnswer": "画像から読み取った生徒の最終解答（LaTeX $...$）。読み取れない場合は空文字。",
                                "feedback": "誤り診断コメント。正解かつ過程も問題なければ空文字。"
                            }

                            `;


                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`, {

                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }

                    ,
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }

                                ,
                            {
                                inline_data: {
                                    mime_type: "image/png",
                                    data: imageData
                                }
                            }

                            ]
                        }

                        ]
                    })
                });

                if (!response.ok) {
                    const errorText = await response.text();

                    throw new Error(`API Error: ${response.status} - ${errorText}`);
                }

                const data = await response.json();

                // レスポンス構造のチェック
                if (!data.candidates || data.candidates.length === 0 || !data.candidates[0].content) {
                    throw new Error("No candidates returned from API");
                }

                const aiText = data.candidates[0].content.parts[0].text;
                console.log("AI Response:", aiText);

                let result;

                try {
                    result = parseAIJsonWithRepair(aiText);
                }

                catch (e) {
                    console.error("JSON parse error:", e);
                    throw new Error("AIの応答を解析できませんでした。");
                }

                indicator.style.display = 'none';

                // 結果による分岐
                if (result.isCorrect && !result.hasProcessError) {
                    playSe('correct');
                    // 正解
                    // Answer display fix: color inherited, inline style
                    const cleanAnswer = result.recognizedAnswer ? result.recognizedAnswer.replace(/^\$|\$$/g, '') : '';
                    feedbackEl.className = 'correct-feedback';

                    feedbackEl.innerHTML = `<div class="ai-banner">🤖AIカガワ先生🤖の解答check✅</div><br><span style="color: #28a745;"><strong>正解です！お見事！</strong></span><br>${cleanAnswer ? `<div style="margin:10px 0;"><span style="font-size:0.9em; opacity:0.8;">あなたの解答:</span> $${cleanAnswer
                        }$</div>` : ''
                        }
                    ${result.feedback || ''}
                    <hr><div class="explanation-banner">解説</div><br>${currentQuestion.rationale || ""
                        }`;
                    feedbackEl.style.display = 'block';

                    if (!incorrectQuestions.includes(currentQuestion)) {
                        score++;

                        document.getElementById('score').textContent = `Score: ${score}`;
                    }

                    if (currentQuestionIndex < quizData.length - 1) {
                        nextBtn.style.display = 'block';
                    }

                    else {
                        resultsBtn.style.display = 'block';
                    }

                }

                else if (result.isCorrect && result.hasProcessError) {
                    playSe('correct');
                    // 答えは合っているがプロセスエラー
                    const cleanAnswer = result.recognizedAnswer ? result.recognizedAnswer.replace(/^\$|\$$/g, '') : '';
                    feedbackEl.className = 'incorrect-feedback';

                    feedbackEl.innerHTML = ` <div class="ai-banner" >🤖AIカガワ先生🤖の解答check✅</div><br> <span style="color: #e0a800;" ><strong>答えは合っていますが...</strong></span><br> ${cleanAnswer ? `<div style="margin:10px 0;"><span style="font-size:0.9em; opacity:0.8;">あなたの解答:</span> $${cleanAnswer
                        }$</div>` : ''
                        }
                    ${result.feedback
                        }
                    <hr><div class="explanation-banner">解説</div><br>${currentQuestion.rationale || ""
                        }`;
                    feedbackEl.style.display = 'block';

                    if (currentQuestionIndex < quizData.length - 1) {
                        nextBtn.style.display = 'block';
                    } else {
                        resultsBtn.style.display = 'block';
                    }

                }

                else {
                    playSe('incorrect');
                    // 不正解
                    showWrongDecisionUI(currentQuestion, result);
                }

                renderAllMath();

            }

            catch (error) {
                console.error(error);
                let errorMsg = "不明なエラーが発生しました。";

                if (error.message.includes("404")) {
                    errorMsg = "モデルが見つかりません (404)。APIキーまたはモデル名を確認してください。";
                }

                else if (error.message.includes("400")) {
                    errorMsg = "リクエストが不正です (400)。APIキーが無効な可能性があります。";
                }

                else if (error.message.includes("403")) {
                    errorMsg = "アクセス権限がありません (403)。APIキーを確認してください。";
                }

                else if (error.message.includes("429")) {
                    errorMsg = "リクエスト回数制限を超えました (429)。しばらく待ってから再試行してください。";
                }

                else {
                    errorMsg = error.message;
                }

                indicator.style.display = 'none';
                answerBtn.style.display = 'block';

                feedbackEl.className = 'incorrect-feedback';

                feedbackEl.innerHTML = ` <div class="ai-banner" >⚠️ エラーが発生しました</div><br> <p>${errorMsg
                    }

                </p> <p style="font-size:0.8em; color:#666;" >詳細: ${error.message
                    }

                </p> <div style="text-align:center; margin-top:10px;" > <button class="tool-btn" onclick="checkAnswerWithAI()" >再試行</button> </div> `;
                feedbackEl.style.display = 'block';
            }
        }

        function closeAiModal() {
            document.getElementById('ai-modal').style.display = 'none';
        }

        // --- 読み上げ ---
        window.speakRationale = function (btn) {
            if (synth.speaking) {
                synth.cancel(); return;
            }

            // 簡易実装
            const text = btn.parentElement.innerText.replace(/🔊/g, '');
            const u = new SpeechSynthesisUtterance(text);
            u.lang = 'ja-JP';
            synth.speak(u);
        }

            ;

        function renderAllMath() {
            if (window.renderMathInElement) {
                renderMathInElement(document.body, {
                    delimiters: [{
                        left: '$$', right: '$$', display: true
                    }

                        ,
                    {
                        left: '$', right: '$', display: false
                    }

                        ,
                    {
                        left: '\\(', right: '\\)', display: false
                    }

                        ,
                    {
                        left: '\\[', right: '\\]', display: true
                    }

                    ],
                    throwOnError: false
                });
            }
        }

        // --- リサイザー機能 ---
        const resizer = document.getElementById('resizer');
        const leftPanel = document.getElementById('left-panel');
        const rightPanel = document.getElementById('right-panel');
        let isResizing = false;

        resizer.addEventListener('mousedown', (e) => {
            isResizing = true;
            resizer.classList.add('active');
            document.body.style.cursor = 'col-resize';
            // 選択防止
            document.body.style.userSelect = 'none';
        });

        document.addEventListener('mousemove', (e) => {
            if (!isResizing) return;
            const containerWidth = document.body.clientWidth;
            const x = e.clientX;
            const leftWidthPercent = (x / containerWidth) * 100;

            if (leftWidthPercent > 10 && leftWidthPercent < 90) {
                leftPanel.style.flex = `0 0 ${leftWidthPercent
                    }

                    vw`;

                leftPanel.style.width = `${leftWidthPercent
                    }

                    vw`;

                rightPanel.style.flex = `0 0 ${100 - leftWidthPercent
                    }

                    vw`;

                rightPanel.style.width = `${100 - leftWidthPercent
                    }

                    vw`;
                resizeCanvas();
            }
        });

        document.addEventListener('mouseup', () => {
            if (isResizing) {
                isResizing = false;
                resizer.classList.remove('active');
                document.body.style.cursor = '';
                document.body.style.userSelect = '';
                resizeCanvas();
            }
        });

        // タッチ対応
        resizer.addEventListener('touchstart', (e) => {
            isResizing = true;
            resizer.classList.add('active');
        }

            , {
                passive: false
            });

        document.addEventListener('touchmove', (e) => {
            if (!isResizing) return;
            const touch = e.touches[0];
            const containerWidth = document.body.clientWidth;
            const x = touch.clientX;
            const leftWidthPercent = (x / containerWidth) * 100;

            if (leftWidthPercent > 10 && leftWidthPercent < 90) {
                leftPanel.style.flex = `0 0 ${leftWidthPercent
                    }

                    vw`;

                leftPanel.style.width = `${leftWidthPercent
                    }

                    vw`;

                rightPanel.style.flex = `0 0 ${100 - leftWidthPercent
                    }

                    vw`;

                rightPanel.style.width = `${100 - leftWidthPercent
                    }

                    vw`;
                resizeCanvas();
            }
        }

            , {
                passive: false
            });

        document.addEventListener('touchend', () => {
            if (isResizing) {
                isResizing = false;
                resizer.classList.remove('active');
                resizeCanvas();
            }
        });


        // --- Missing Utility Functions Restored ---

        function setTool(tool) {
            currentTool = tool;

            // UI更新
            document.querySelectorAll('.tool-btn').forEach(btn => btn.classList.remove('active'));
            if (tool === 'pen') document.getElementById('btn-pen').classList.add('active');
            if (tool === 'pen-red') document.getElementById('btn-pen-red').classList.add('active');
            if (tool === 'eraser') document.getElementById('btn-eraser').classList.add('active');

            if (tool === 'graph') {
                const gb = document.getElementById('btn-graph');
                if (gb) gb.classList.add('active');
            }

            if (tool === 'graph') {
                toggleGraphMode(true);

                // (2)グラフ作成時は自動的に2ページ目へ
                if (currentPageIndex === 0) {
                    if (memoPages.length < 2) {
                        addNewPage(); // 2ページ目がなければ作成
                    }

                    else {
                        switchPage(1); // 2ページ目があれば遷移 (index 0 -> index 1)
                    }
                }

                if (!systemGraphData) {
                    drawUserGraph();
                }

                const guide = document.getElementById('graph-guide');

                if (guide && graphState === 'none') {
                    guide.style.display = 'block';
                }
            }

            else {
                toggleGraphMode(false);
                const cursor = document.getElementById('eraser-cursor');
                if (cursor) cursor.style.display = 'none';
                const guide = document.getElementById('graph-guide');
                if (guide) guide.style.display = 'none';
            }

            // Re-render to update grid visibility based on tool
            if (canvas) resizeCanvas();
        }

        function toggleGraphMode(isActive) {
            const container = document.getElementById('memo-container');
            const guide = document.getElementById('graph-guide');

            if (isActive) {
                if (container) container.classList.add('graph-active');
                if (guide) guide.style.display = 'block';
                // ペンを自動で「ペン」にする等は setTool で制御済み
            } else {
                if (container) container.classList.remove('graph-active');
                if (guide) guide.style.display = 'none';
            }
        }

        function togglePenOnly() {
            isPenOnlyMode = !isPenOnlyMode;
            const btn = document.getElementById('btn-pen-only');

            if (isPenOnlyMode) {
                btn.classList.add('active');
                btn.innerHTML = '🖊️ ペンのみ';
            }

            else {
                btn.classList.remove('active');
                btn.innerHTML = '👆 指もOK';
            }
        }

        function clearMemo() {
            if (!ctx) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            saveMemoState();
            resetGraphMode();
        }

        function saveMemoState() {
            if (memoHistory.length >= MAX_HISTORY) {
                memoHistory.shift();
            }

            // ImageData保存
            let img = null;

            if (canvas.width > 0 && canvas.height > 0) {
                img = ctx.getImageData(0, 0, canvas.width, canvas.height);
            }

            memoHistory.push({

                image: img,
                graph: {
                    state: graphState,
                    vertex: graphVertex,
                    point: graphPoint,
                    systemData: systemGraphData
                }
            });
        }

        function undoMemo() {
            if (memoHistory.length > 0) {
                const state = memoHistory.pop();

                if (state.image) {
                    ctx.putImageData(state.image, 0, 0);
                }

                // Restore graph state
                if (state.graph) {
                    graphState = state.graph.state;
                    graphVertex = state.graph.vertex;
                    graphPoint = state.graph.point;
                    systemGraphData = state.graph.systemData;
                }

                else {
                    resetGraphMode();
                }

                // If in graph mode, re-render might be needed to show grid if it was lost (though imageData usually has it?)
                // Actually, if we treat grid as background, imageData might not have it if we used clearRect in drawUserGraph.
                // But in current implementation drawUserGraph clears rect and draws grid + content.
                // So undoing imageData will restore pixel state.
                // We should ensure logical state is synced.
            }
        }

        function resetGraphMode() {
            graphState = 'none';
            graphVertex = null;
            graphPoint = null;
            systemGraphData = null;
            // Guide update
            const guide = document.getElementById('graph-guide');

            if (guide) {
                guide.textContent = "頂点をタップしてください";
                guide.style.display = 'none';
            }
        }

        function saveMemo() {
            // html2canvasを使ってメモコンテナ全体（問題文含む）を画像化
            const element = document.getElementById('memo-container');
            const overlay = document.getElementById('memo-question-overlay');
            const wasHidden = (overlay.style.display === 'none' || overlay.style.display === '');

            // 保存時のみ一時的に問題文を表示
            if (wasHidden) {
                overlay.style.display = 'block';
                // 数式などが正しくレンダリングされているか確認（非表示だと崩れることがあるため念のため）
                renderAllMath();
            }

            html2canvas(element, {
                backgroundColor: isDarkMode ? '#121212' : '#ffffff', // 背景色を明示
                scale: 2 // 高解像度で取得
            }).then(canvas => {
                // 元の状態に戻す（キャプチャ完了後すぐに戻す）
                if (wasHidden) {
                    overlay.style.display = 'none';
                }

                const now = new Date();
                const dateStr = now.getFullYear() +
                    ('0' + (now.getMonth() + 1)).slice(-2) +
                    ('0' + now.getDate()).slice(-2) + '_' +
                    ('0' + now.getHours()).slice(-2) +
                    ('0' + now.getMinutes()).slice(-2) +
                    ('0' + now.getSeconds()).slice(-2);
                const fileName = `memo_${dateStr}.png`;

                canvas.toBlob(async (blob) => {
                    if (!blob) return;

                    const file = new File([blob], fileName, { type: 'image/png' });

                    // プレビュー表示
                    const previewImg = document.getElementById('preview-image');
                    previewImg.src = URL.createObjectURL(blob);

                    // シェアボタンの表示制御
                    const shareBtn = document.getElementById('preview-share-btn');
                    // Check if share button exists (it might not in M1-3-1-6 if not copied)
                    // If not, we skip this part or assume standard preview modal structure
                    if (shareBtn && navigator.canShare && navigator.canShare({ files: [file] })) {
                        shareBtn.style.display = 'inline-block';
                        shareBtn.onclick = async () => {
                            try {
                                await navigator.share({
                                    files: [file],
                                    title: 'メモを保存',
                                    text: 'メモ画像を保存します'
                                });
                            } catch (err) {
                                console.log('Share cancelled or failed', err);
                            }
                        };
                    } else if (shareBtn) {
                        shareBtn.style.display = 'none';
                    }

                    document.getElementById('image-preview-modal').style.display = 'flex';
                });
            });
        }

        function closeImagePreview() {
            document.getElementById('image-preview-modal').style.display = 'none';
        }

        function toggleQuestionOverlay() {
            const overlay = document.getElementById('memo-question-overlay');
            const btn = document.getElementById('btn-toggle-question');

            if (overlay.style.display === 'block') {
                overlay.style.display = 'none';
                btn.classList.remove('active');
            }

            else {
                overlay.style.display = 'block';
                btn.classList.add('active');
            }
        }

        function updateResumeButton() {
            // Placeholder
        }

        function saveProgress() {
            try {
                const progress = {
                    quizData: quizData,
                    currentQuestionIndex: currentQuestionIndex,
                    incorrectQuestions: incorrectQuestions
                }

                    ;
                localStorage.setItem('quiz_progress_M1-3-1-6', JSON.stringify(progress));
            }

            catch (e) {
                console.error("Save progress failed", e);
            }
        }

        function updateProgressAndScore() {
            // Placeholder if needed
        }

        function sendResults() {
            alert("送信機能は未実装です");
        }

        function initAudioContext() {
            try {
                const AudioContext = window.AudioContext || window.webkitAudioContext;

                if (!audioCtx && AudioContext) {
                    audioCtx = new AudioContext();
                }
            }

            catch (e) {
                console.error("Web Audio API not supported", e);
            }
        }

        function playSe(type) {
            if (!isSoundOn) return;
            initAudioContext();
            if (!audioCtx) return;

            // Simple oscillator logic
            try {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);

                const now = audioCtx.currentTime;

                if (type === 'correct') {
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(1000, now);
                    osc.frequency.setValueAtTime(1500, now + 0.1);
                    gain.gain.setValueAtTime(0.1, now);
                    gain.gain.linearRampToValueAtTime(0, now + 0.3);
                    osc.start(now);
                    osc.stop(now + 0.3);
                }

                else if (type === 'incorrect') {
                    osc.type = 'sawtooth';
                    osc.frequency.setValueAtTime(150, now);
                    osc.frequency.linearRampToValueAtTime(100, now + 0.3);
                    gain.gain.setValueAtTime(0.1, now);
                    gain.gain.linearRampToValueAtTime(0, now + 0.3);
                    osc.start(now);
                    osc.stop(now + 0.3);
                }

                else if (type === 'button') {
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(800, now);
                    gain.gain.setValueAtTime(0.05, now);
                    gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
                    osc.start(now);
                    osc.stop(now + 0.1);
                }
            }

            catch (e) {
                console.error(e);
            }
        }

        // --- Clean Graph Implementation ---
        let isResizingCanvas = false;

        function initCanvas() {
            canvas = document.getElementById('memo-pad');
            if (!canvas) return;

            ctx = canvas.getContext('2d', {
                willReadFrequently: true
            });

            updateSystemOrigin();
            resizeCanvas();

            // 基本お絵描きイベント
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);

            // タッチイベント
            canvas.addEventListener('touchstart', startDrawing, {
                passive: false
            });

            canvas.addEventListener('touchmove', draw, {
                passive: false
            });
            canvas.addEventListener('touchend', stopDrawing);

            // グラフ操作イベント (Pointer Events for unified handling)
            canvas.addEventListener('pointerdown', handleGraphInteraction);
            // pointermoveは重いので必要な時だけ、あるいはhandled in handleGraphInteraction if tracking drag
        }

        function resizeCanvas() {
            if (isResizingCanvas) return;
            isResizingCanvas = true;

            const container = document.getElementById('memo-container');

            if (!container || !canvas) {
                isResizingCanvas = false;
                return;
            }

            // 現在の描画内容を保存
            let savedData = null;

            if (canvas.width > 0 && canvas.height > 0) {
                savedData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            }

            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
            updateSystemOrigin();

            // 復元
            if (savedData) {
                ctx.putImageData(savedData, 0, 0);
            }

            // グラフモードなら再描画（グリッドなど）
            if (currentTool === 'graph') {
                drawUserGraph();
            }

            isResizingCanvas = false;
        }

        function startDrawing(e) {
            if (currentTool === 'graph') {
                // handleGraphInteraction is handled by pointerdown listener separately
                // but we might want to prevent default drawing
                return;
            }

            e.preventDefault();
            isDrawing = true;
            saveMemoState();
            draw(e);
        }

        function stopDrawing() {
            isDrawing = false;
            ctx.beginPath();
        }

        function draw(e) {
            if (currentTool === 'graph') return;
            if (!isDrawing) return;

            // パームリジェクション簡易判定
            if (isPenOnlyMode && e.pointerType === 'touch') return;

            if (isPenOnlyMode && e.touches && e.touches[0] && (e.touches[0].radiusX > 10 || e.touches[0].radiusY > 10)) {
                // 太い接触は無視（指とみなす）
                // return; // 調整難しいため一旦コメントアウト
            }

            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            let clientX, clientY;

            if (e.changedTouches) {
                clientX = e.changedTouches[0].clientX;
                clientY = e.changedTouches[0].clientY;
            }

            else {
                clientX = e.clientX;
                clientY = e.clientY;
            }

            const x = clientX - rect.left;
            const y = clientY - rect.top;

            ctx.lineWidth = 3;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';

            if (currentTool === 'eraser') {
                ctx.globalCompositeOperation = 'destination-out';
                ctx.lineWidth = 20;
                ctx.lineTo(x, y);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(x, y);
                updateCursor(x, y);
            }

            else {
                ctx.globalCompositeOperation = 'source-over';
                ctx.strokeStyle = (currentTool === 'pen-red') ? '#ff0000' : currentPenColor;
                ctx.lineTo(x, y);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(x, y);
            }
        }

        function updateCursor(x, y) {
            const cursor = document.getElementById('eraser-cursor');

            if (currentTool === 'eraser') {
                cursor.style.display = 'block';
                cursor.style.left = x + 'px';
                cursor.style.top = y + 'px';
            }

            else {
                cursor.style.display = 'none';
            }
        }

        // --- グラフツールロジック ---
        let isGraphDragging = false;
        let dragTarget = null; // 'vertex' or 'point'

        function handleGraphInteraction(e) {
            if (currentTool !== 'graph') return;
            if (e.isPrimary === false) return;

            e.preventDefault();
            const rect = canvas.getBoundingClientRect();

            // Mouse/Touch capture
            canvas.setPointerCapture(e.pointerId);

            const startX = e.clientX - rect.left;
            const startY = e.clientY - rect.top;
            const logic = canvasToLogical(startX, startY);
            const gx = snapToGrid(logic.x);
            const gy = snapToGrid(logic.y);

            // 履歴保存 (変更前に保存しないとUndoできない)
            saveMemoState();

            isGraphDragging = true;

            // どの点を操作するか決定
            if (graphState === 'completed') {
                // 既存点の修正モード
                const dv = Math.hypot(gx - graphVertex.x, gy - graphVertex.y);
                const dp = Math.hypot(gx - graphPoint.x, gy - graphPoint.y);

                // 近くの点を掴む (判定甘めに)
                if (dv < 1.0) {
                    // 距離1.0以内なら頂点とみなす
                    dragTarget = 'vertex';

                    graphVertex = {
                        x: gx, y: gy
                    }

                        ;
                }

                else if (dp < 1.0) {
                    dragTarget = 'point';

                    graphPoint = {
                        x: gx, y: gy
                    }

                        ;
                }

                else {

                    // どちらでもない場合、近い方を新規ターゲットにするか、無視するか
                    // ここでは直感的に「新しい場所に移動」＝「近い方を動かす」とする
                    if (dv <= dp) {
                        dragTarget = 'vertex';

                        graphVertex = {
                            x: gx, y: gy
                        }

                            ;
                    }

                    else {
                        dragTarget = 'point';

                        graphPoint = {
                            x: gx, y: gy
                        }

                            ;
                    }
                }
            }

            else if (graphState === 'set-vertex') {
                // 2点目（通過点）の配置開始
                dragTarget = 'point';

                graphPoint = {
                    x: gx, y: gy
                }

                    ;
            }

            else {
                // 初期状態：頂点の配置開始
                dragTarget = 'vertex';

                graphVertex = {
                    x: gx, y: gy
                }

                    ;
                graphPoint = null;
                graphState = 'set-vertex'; // 一旦vertex設定中にする
            }

            drawUserGraph();

            // ドラッグイベント登録
            function onPointerMove(moveEvent) {
                if (!isGraphDragging) return;
                moveEvent.preventDefault();

                const mx = moveEvent.clientX - rect.left;
                const my = moveEvent.clientY - rect.top;
                const mLogic = canvasToLogical(mx, my);
                const mgx = snapToGrid(mLogic.x);
                const mgy = snapToGrid(mLogic.y);

                if (dragTarget === 'vertex') {
                    graphVertex = {
                        x: mgx, y: mgy
                    }

                        ;
                }

                else if (dragTarget === 'point') {
                    graphPoint = {
                        x: mgx, y: mgy
                    }

                        ;
                }

                drawUserGraph();
            }

            function onPointerUp(upEvent) {
                isGraphDragging = false;
                canvas.releasePointerCapture(upEvent.pointerId);
                canvas.removeEventListener('pointermove', onPointerMove);
                canvas.removeEventListener('pointerup', onPointerUp);

                // 確定処理
                if (dragTarget === 'vertex') {
                    // Vertex確定
                    // 次のステップへガイド
                    const guide = document.getElementById('graph-guide');

                    if (guide) {
                        if (graphState === 'completed') {
                            guide.style.display = 'none';
                        }

                        else {
                            guide.textContent = "もう1点をドラッグして放物線を決定";
                            guide.style.display = 'block';
                            graphState = 'set-vertex'; // 状態維持
                        }
                    }
                }

                else if (dragTarget === 'point') {

                    // Point確定 -> 完成
                    // Vertexと同じ座標ならキャンセル扱いにするか？
                    if (graphVertex.x === graphPoint.x && graphVertex.y === graphPoint.y) {
                        // 重なった場合は無効（pointをnullに戻す）
                        graphPoint = null;

                        if (graphState === 'completed') {
                            // 修正モードで重ねてしまった場合どうする？ -> 削除はしないが戻す？
                            // とりあえず頂点のみ状態に戻す
                            graphState = 'set-vertex';
                        }
                    }

                    else {
                        graphState = 'completed';
                        const guide = document.getElementById('graph-guide');
                        if (guide) guide.style.display = 'none';
                    }
                }

                // システムデータ更新
                if (graphState === 'completed' && graphVertex && graphPoint) {
                    systemGraphData = {
                        vertex: `(${graphVertex.x
                            }

                            , ${graphVertex.y

                            })`,
                        point: `(${graphPoint.x
                            }

                            , ${graphPoint.y
                            })`
                    }

                        ;
                }

                // 履歴保存はdown時に行っているためここではない
                drawUserGraph();
            }

            canvas.addEventListener('pointermove', onPointerMove);
            canvas.addEventListener('pointerup', onPointerUp);
        }

        function drawUserGraph() {
            // 背景クリア (Grid再描画のため全クリア)
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // グリッド
            drawGrid();

            // パス描画
            drawFunctionPath();
        }

        function drawGrid() {
            const w = canvas.width;
            const h = canvas.height;

            const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(200, 200, 200, 0.5)';
            const axisColor = isDarkMode ? 'rgba(255, 255, 255, 0.8)' : 'rgba(0, 0, 0, 0.8)';

            ctx.beginPath();
            ctx.strokeStyle = gridColor;
            ctx.lineWidth = 1;

            // 縦線
            const maxSteps = Math.ceil(w / SYSTEM_SCALE / 2) + 1; // 画面半分に必要なステップ数

            for (let i = 0; i <= maxSteps; i++) {
                // 中心から右へ
                let x = SYSTEM_ORIGIN.x + i * SYSTEM_SCALE;
                ctx.moveTo(x, 0); ctx.lineTo(x, h);
                // 中心から左へ
                x = SYSTEM_ORIGIN.x - i * SYSTEM_SCALE;
                ctx.moveTo(x, 0); ctx.lineTo(x, h);
            }

            const maxStepsY = Math.ceil(h / SYSTEM_SCALE / 2) + 1;

            for (let i = 0; i <= maxStepsY; i++) {
                // 中心から下へ
                let y = SYSTEM_ORIGIN.y + i * SYSTEM_SCALE;
                ctx.moveTo(0, y); ctx.lineTo(w, y);
                // 中心から上へ
                y = SYSTEM_ORIGIN.y - i * SYSTEM_SCALE;
                ctx.moveTo(0, y); ctx.lineTo(w, y);
            }

            ctx.stroke();

            // 軸
            ctx.beginPath();
            ctx.strokeStyle = axisColor;
            ctx.lineWidth = 2;
            ctx.moveTo(0, SYSTEM_ORIGIN.y); ctx.lineTo(w, SYSTEM_ORIGIN.y); // X
            ctx.moveTo(SYSTEM_ORIGIN.x, 0); ctx.lineTo(SYSTEM_ORIGIN.x, h); // Y
            ctx.stroke();
        }

        function drawFunctionPath() {
            if (!graphVertex) return;

            // Colors
            const vertexColor = isDarkMode ? '#ff5252' : '#ff0000'; // Light Red vs Red
            const pointColor = isDarkMode ? '#448aff' : '#0000ff'; // Light Blue vs Blue
            const lineColor = isDarkMode ? '#69f0ae' : '#00b894'; // Light Teal vs Teal

            // Draw Vertex
            const cv = logicalToCanvas(graphVertex.x, graphVertex.y);
            ctx.fillStyle = vertexColor;
            ctx.beginPath(); ctx.arc(cv.x, cv.y, 5, 0, Math.PI * 2); ctx.fill();

            // 座標表示 (Vertex) - 整数座標の場合のみ表示
            if (Number.isInteger(graphVertex.x) && Number.isInteger(graphVertex.y)) {
                ctx.fillStyle = vertexColor;
                ctx.font = 'bold 14px "OutFit", sans-serif';
                ctx.textAlign = 'left';
                ctx.textBaseline = 'bottom';
                ctx.fillText(`(${graphVertex.x}, ${graphVertex.y})`, cv.x + 8, cv.y - 8);
            }

            if (graphPoint) {
                const cp = logicalToCanvas(graphPoint.x, graphPoint.y);
                ctx.fillStyle = pointColor;
                ctx.beginPath(); ctx.arc(cp.x, cp.y, 5, 0, Math.PI * 2); ctx.fill();

                // 座標表示 (Pass Point) - 整数座標の場合のみ表示
                if (Number.isInteger(graphPoint.x) && Number.isInteger(graphPoint.y)) {
                    ctx.fillStyle = pointColor;
                    ctx.textAlign = 'left';
                    ctx.textBaseline = 'bottom'; // 統一
                    ctx.fillText(`(${graphPoint.x}, ${graphPoint.y})`, cp.x + 8, cp.y - 8);
                }

                // Draw Parabola
                // y = a(x-p)^2 + q
                const p = graphVertex.x;
                const q = graphVertex.y;
                // Calculate a
                const dx = graphPoint.x - p;
                if (Math.abs(dx) < 1e-9) return; // 軸と重なると描画不能
                const a = (graphPoint.y - q) / (dx * dx);

                ctx.beginPath();
                ctx.strokeStyle = lineColor;
                ctx.lineWidth = 3;

                // 描画範囲 (Logic X)
                const startLogicX = SYSTEM_ORIGIN.x > 0 ? -SYSTEM_ORIGIN.x / SYSTEM_SCALE : 0;
                // ... 簡易的に画面全体をカバーする範囲
                // -10 to 10 くらいで十分だが、画面サイズに合わせて
                const w = canvas.width;
                const minX = - (SYSTEM_ORIGIN.x / SYSTEM_SCALE);
                const maxX = (w - SYSTEM_ORIGIN.x) / SYSTEM_SCALE;

                // 解像度
                const step = 0.1;
                let first = true;

                for (let x = minX; x <= maxX; x += step) {
                    const y = a * (x - p) * (x - p) + q;
                    const c = logicalToCanvas(x, y);

                    if (first) {
                        ctx.moveTo(c.x, c.y);
                        first = false;
                    }

                    else {
                        ctx.lineTo(c.x, c.y);
                    }
                }

                ctx.stroke();
            }
        }

    </script>
</body>

</html>

