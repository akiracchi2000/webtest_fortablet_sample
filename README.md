# 基本大全ウェブテスト (For Tablet)

タブレット端末での利用に最適化された、数学のウェブテストアプリケーションです。
手書きメモ機能や、生成AI（Gemini）による手書き解答の自動採点・解説機能を備えています。

## 主な機能

- **手書きメモパッド**: 画面右側に計算用紙として使えるキャンバスを搭載。Apple Pencilなどのスタイラスペンでの入力に対応し、パームリジェクション機能も備えています。
- **AIカガワ先生の解答Check**: 答え合わせの際に、手書きのメモをAIが分析し、正誤判定とアドバイスを行います。
- **自動採点**: クイズ形式で問題を解き、即座に正誤判定と解説が表示されます。
- **結果送信**: テスト結果をGoogleスプレッドシートに送信・保存できます（GAS連携）。
- **ダークモード**: 目に優しいダークモードへの切り替えが可能です。

## セットアップと使用方法

### 1. アプリの起動
`index.html` をブラウザ（Chrome, Safariなど）で開いてください。これがトップページ（メニュー画面）となります。

### 2. 初期設定
アプリをフル活用するために、以下の設定を行ってください。トップページ右上の歯車アイコン⚙️から設定できます。

- **Gemini APIキーの設定**: AI分析機能を使用するために必要です。
  - 詳しくは [API キーの取得ガイド.md](./API%20キーの取得ガイド.md) をご覧ください。
- **お名前の登録**: テスト結果を送信する際の生徒名を登録します。
- **GAS URLの設定**: 結果をスプレッドシートに保存する場合に設定します。
  - 詳しくは [GASセットアップガイド.md](./GASセットアップガイド.md) をご覧ください。

### 3. テストの実施
トップページから単元を選択してテストを開始してください。
- 左側に問題、右側にメモパッドが表示されます。
- 解答をメモパッドに記入し、「回答する」ボタンを押します。
- 「🤖AIカガワ先生」が登場し、手書き解答の採点と解説を行います。

## ファイル構成

- `index.html`: トップページ（メニュー画面）。
- `M1-*-*-*.html`: 各単元のテストページ本体。
- `M1-*-*-*QD.js`: 各単元の問題データファイル。
- `API キーの取得ガイド.md`: Gemini APIキーの取得手順書。
- `GASセットアップガイド.md`: 結果送信用のGoogle Apps Scriptセットアップ手順書。

## 動作環境
- 推奨ブラウザ: Google Chrome, Safari
- 推奨デバイス: iPadなどのタブレット端末（PCでも利用可能ですが、手書き機能はタブレット推奨です）

## 更新履歴 (Change Log)

### v1.1.0 (2025-12-16)
**手書き認識と描画品質の向上アップデート**

- **手書き認識精度の向上**:
  - 画像処理ロジックを刷新（`getCanvasImageBase64`）。描画された文字を強制的に「黒」、背景を「白」に変換し、さらに描画範囲のみを自動で切り抜く（オートクロップ）ことで、AIの認識率を大幅に向上させました。特に「0」や「小数点」などの小さな文字が無視される問題を解決しました。
- **描画品質の改善**:
  - `PointerEvent` および `getCoalescedEvents` に対応し、素早くペンを動かした際のカクつきを解消。滑らかな曲線が描けるようになりました。
  - ペンの太さを `3px` から `4px` に変更し、視認性を向上させました。
  - 高解像度ディスプレイ（Retinaディスプレイ等）でのレンダリングに対応し、線がぼやける問題を解消しました。
- **不具合修正**:
  - アプリ起動時に「問題文が表示されない」不具合を修正（スクリプトの読み込み順序と競合の解決）。
  - `M1-3-1-6`（グラフ操作問題）において、手書き機能との共存が正しく動作するように個別の修復を実施。